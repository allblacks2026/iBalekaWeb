function initAutocomplete(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{types:["geocode"]});autocomplete.addListener("place_changed",fillInAddress)}function initMap(){map=new google.maps.Map(document.getElementById("map"),{zoom:15,center:{lat:-33.9913503,lng:25.6568993},zoomControl:!0,streetViewControl:!1,scaleControl:!0});getLocation();var n=document.getElementById("toolBoxWrapper");n.index=1;map.controls[google.maps.ControlPosition.TOP_CENTER].push(n);map.addListener("click",addCheckPoint)}function getLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(showPosition)}function showPosition(n){map.setCenter(new google.maps.LatLng(n.coords.latitude,n.coords.longitude))}function addCheckPoint(n){routePoints.push(n.latLng);routePath===undefined||routePath.setMap(null);routePath=getRoutePath();routePath.setMap(map);var t=getMarkerUniqueId(n.latLng.lat(),n.latLng.lng());marker=new google.maps.Marker({position:n.latLng,draggable:!0,title:"Checkpoint "+routePoints.length,id:routePoints.length,map:map});markers[t]=marker;markersOrders.push(marker);dragMarkerEvent(marker);updateToolboxStats();bindMarkerPolylineEvents(marker)}function dragMarkerEvent(n){google.maps.event.addListener(n,"dragstart",function(){prevLocation=n.getPosition();google.maps.event.addListener(n,"dragend",function(t){for(var r,u,i=0;i<routePoints.length;i++)if(routePoints[i]===prevLocation){routePoints[i]=t.latLng;break}for(r in markers)if(markers.hasOwnProperty(r)&&r===getMarkerUniqueId(prevLocation.lat(),prevLocation.lng())){u=getMarkerUniqueId(t.latLng.lat(),t.latLng.lng());markers[u]=n;delete markers[r];break}resetPolyline()})})}function getRoutePath(){return new google.maps.Polyline({path:routePoints,strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,geodesic:!0})}function bindMarkerPolylineEvents(n){google.maps.event.addListener(n,"rightclick",function(n){var t=getMarkerUniqueId(n.latLng.lat(),n.latLng.lng()),i=markers[t];removeCheckpoint(i,t);removePolyline(n);resetPolyline();refreshMarkers()})}function removeCheckpoint(n,t){n.setMap(null);delete markers[t];for(var i=0;i<markersOrders.length;i++)if(markersOrders[i]===n){markersOrders.splice(i,1);break}updateToolboxStats()}function removePolyline(n){for(var t=0;t<routePoints.length;t++)if(routePoints[t]===n.latLng){routePoints.splice(t,1);break}}function resetPolyline(){routePath.setMap(null);routePath=getRoutePath();routePath.setMap(map)}function refreshMarkers(){for(var t,i,n=0;n<markersOrders.length;n++)markersOrders[n].setTitle("Checkpoint "+(n+1));for(t=0;t<markersOrders.length;t++)for(i in markers)if(markersOrders[t].getPosition()===markers[i].getPosition()){markers[i].setTitle("Checkpoint "+(t+1));break}}function createToolbox(){}function saveRoute(){var n=location.origin+"/map/AddRoute";$.ajax({method:"POST",url:n,contentType:"application/json;charset=utf-8",processData:!1,data:createObject(),success:function(){window.location.href=location.origin+"/map/SavedRoutes"},error:function(n,t,i){alert("Error: "+t+" "+i+" "+n)}})}function createObject(){for(var t,r,u=prompt("Enter the Route Title"),i={Title:u,Checkpoints:[],TotalDistance:totalDistance},n=0;n<markersOrders.length;n++)t=markersOrders[n].getPosition(),r={Latitude:t.lat(),Longitude:t.lng()},i.Checkpoints.push(r);return JSON.stringify(i)}function clearRoute(){for(var n in markers)markers[n].setMap(null);markersOrders=[];markers=[];routePoints=[];resetPolyline();updateToolboxStats()}function updateToolboxStats(){nrCheckpointsText.innerHTML="Nr of Checkpoints: "+getCheckpointLength();totalDistanceText.innerHTML="Total Distance "+getTotalDistance()}function getTotalDistance(){return(refreshDistance(),totalDistance>999)?totalDistance/1e3+"km":totalDistance+"m"}function calculateDistance(){var n,t,i;return n=distanceCoords[0],t=distanceCoords[1],i=google.maps.geometry.spherical.computeDistanceBetween(n,t),Math.round(i)}function refreshDistance(){distanceCoords=[];totalDistance=0;for(var n=0;n<markersOrders.length;n++)loadDistanceCoords(markersOrders[n]),n>=1&&(totalDistance+=calculateDistance(distanceCoords))}function loadDistanceCoords(n){distanceCoords.push(n.getPosition());distanceCoords.length>2&&distanceCoords.splice(0,1)}function getCheckpointLength(){return markersOrders.length}function loadRoute(n){routeTitleText.value=n.title;map.setCenter(new google.maps.LatLng(n.checkpoints[0].latitude,n.checkpoints[0].longitude));for(var t=0;t<n.checkpoints.length;t++)loadCheckpoints(n.checkpoints[t]);loadedRoute=n}function loadCheckpoints(n){var t=new google.maps.LatLng(n.latitude,n.longitude),i;routePoints.push(t);routePath===undefined||routePath.setMap(null);routePath=getRoutePath();routePath.setMap(map);i=getMarkerUniqueId(n.latitude,n.longitude);marker=new google.maps.Marker({position:t,draggable:!0,title:"Checkpoint "+routePoints.length,id:routePoints.length,map:map});markers[i]=marker;markersOrders.push(marker);dragMarkerEvent(marker);updateToolboxStats();bindMarkerPolylineEvents(marker)}function updateRoute(){var n=location.origin+"/map/Edit";$.ajax({method:"POST",url:n,contentType:"application/json;charset=utf-8",processData:!1,data:createUpdatedObject(),success:function(){window.location.href=location.origin+"/map/SavedRoutes"},error:function(n,t,i){alert("Error: "+t+" "+i+" "+n)}})}function cancelRoute(){var n=location.origin+"/map/SavedRoutes";$.ajax({method:"GET",url:n,processData:!1,success:function(){window.location.href=location.origin+"/map/SavedRoutes"},error:function(n,t,i){alert("Error: "+t+" "+i+" "+n)}})}function createUpdatedObject(){for(var t,r,i={RouteId:loadedRoute.routeId,Title:routeTitleText.value,Checkpoints:[],TotalDistance:totalDistance},n=0;n<markersOrders.length;n++)t=markersOrders[n].getPosition(),r={Latitude:t.lat(),Longitude:t.lng()},i.Checkpoints.push(r);return JSON.stringify(i)}function loadDeletedRouteId(n){n!==null&&(loadedRouteId=n)}function deleteRoute(){var n=location.origin+"/map/Delete";$.ajax({method:"POST",url:n,contentType:"application/json;charset=utf-8",processData:!1,data:JSON.stringify(loadedRouteId),success:function(){window.location.href=location.origin+"/map/SavedRoutes"},error:function(n,t,i){console.log("Error: "+t.toString()+" "+i.toString()+" "+n.toString())}})}var map,loadedRoute,loadedRouteId;$(".button-collapse").sideNav();$(document).ready(function(){$("select").material_select()});$(function(){Materialize.updateTextFields()});var routePath,marker,prevLocation,markers=[],markersOrders=[],routePoints=[],nrCheckpointsText=document.getElementById("nrCheckpoints"),totalDistanceText=document.getElementById("totalDistance"),routeTitleText=document.getElementById("routeTitle"),totalDistance=0,distanceCoords=[],getMarkerUniqueId=function(n,t){return n+"_"+t};